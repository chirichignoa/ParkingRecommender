version: '3'

services:
  database:
    image: mysql:8.0.13
    ports:
      - "3306:3306"
    environment: 
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: parking
      MYSQL_USER: parkinguser
      MYSQL_PASSWORD: parkinguser
      MYSQL_DATA_DIR: /var/lib/mysql
      MYSQL_RUN_DIR: /run/mysqld
      MYSQL_LOG_DIR: /var/log/mysql
    volumes:
      - ./scripts:/docker-entrypoint-initdb.d/:ro
    networks: 
      - backend

  parkingmeters-service:
    build:
      context: ./ParkingMetersService
      dockerfile: Dockerfile
    working_dir: /app
    ports:
      - "4567:4567"
    links: 
      - database
    networks: 
      - backend

  coordinate-distance-service:
    build:
      context: ./CoordinateDistance
      dockerfile: Dockerfile
    working_dir: /app
    ports:
      - "2525:2525"
    links:
      - parkingmeters-service
    networks: 
      - backend

  recommender-service:
    build:
      context: ./RecommenderService
      dockerfile: Dockerfile
    working_dir: /app
    ports:
      - "5000:5000"
    links:
      - coordinate-distance-service
    networks: 
      - backend

  frontend-module:
    build:
      context: ./ParkingRecommenderFrontend
      dockerfile: Dockerfile
    working_dir: /app
    ports:
      - "3000:80"
    links:
      - recommender-service
    networks: 
      - frontend

networks:
  frontend:
    driver: bridge
  backend:
    driver: bridge